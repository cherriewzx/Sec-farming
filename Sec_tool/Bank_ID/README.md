# 银行卡号检测工具

## 功能说明

本工具用于检测银行卡号的合法性，包括：

1. **长度和数字格式检查**：验证卡号是否为纯数字，长度是否在 13-19 位之间
2. **Luhn 校验**：使用 Luhn 算法验证卡号的校验位是否正确
3. **BIN 码检查**：验证卡号前 6 位（BIN码）是否在合法数据库中，并匹配对应的银行和卡类型

## 文件结构

```
Bank_ID/
├── bank_id.py          # 主程序
├── bank_id.txt         # 输入文件（待检测的银行卡号，一行一个）
├── result.txt          # 输出文件（检测结果）
├── src/
│   ├── banks.ts        # 银行代码和名称对照表
│   └── bin.ts          # BIN码和银行对照表
└── README.md           # 本说明文档
```

## 使用方法

### 1. 准备输入文件

创建或编辑 `bank_id.txt` 文件，每行输入一个银行卡号：

```
6228480000000000000
6222020000000000000
6217000000000000004
```

### 2. 运行程序

```bash
python3 bank_id.py
```

### 3. 查看结果

程序会在 `result.txt` 文件中输出检测结果，格式如下：

```
卡号	合法	卡类型	银行
6228480000000000000	是	借记卡	中国农业银行
6222020000000000000	是	借记卡	中国工商银行
1234567890123456	否		
```

## 输出字段说明

- **卡号**：输入的银行卡号
- **合法**：是否合法（是/否）
- **卡类型**：银行卡类型（借记卡/信用卡/准贷记卡/预付卡），不合法时为空
- **银行**：银行名称，不合法时为空

## 检测规则

### 1. 格式检查
- 卡号必须为纯数字（允许包含空格和横杠，会自动清理）
- 长度必须在 13-19 位之间

### 2. Luhn 校验
- 使用标准的 Luhn 算法验证校验位
- 如果 Luhn 校验失败，直接判定为不合法

### 3. BIN 码匹配
- 从卡号前 6 位开始匹配 BIN 码（支持最长 10 位 BIN 码）
- 使用最长匹配原则，优先匹配更长的 BIN 码
- 必须同时满足：
  - BIN 码匹配成功
  - 卡号长度与 BIN 码要求的长度一致

## 错误提示

程序会输出详细的错误原因：

- `格式错误：包含非数字字符` - 卡号包含非数字字符
- `长度错误：XX 位（应为 13-19 位）` - 卡号长度不符合要求
- `Luhn 校验失败` - Luhn 算法验证失败
- `BIN 码无效：前6位未匹配到合法BIN码` - 无法匹配到合法的 BIN 码
- `长度不匹配：BIN码要求 XX 位，实际 XX 位` - BIN 码匹配成功但长度不匹配

## 示例

### 合法卡号示例

```
6228480000000000000  # 中国农业银行借记卡（19位）
6222020000000000000  # 中国工商银行借记卡（19位）
6225750000000006     # 招商银行信用卡（16位）
```

### 不合法卡号示例

```
1234567890123456     # Luhn 校验失败
62220212345678901234 # 长度错误（20位）
abc1234567890123     # 格式错误（包含字母）
6228480000000000001  # Luhn 校验失败
```

## 注意事项

1. 输入的卡号会自动清理空格和横杠
2. BIN 码匹配使用最长匹配原则，确保准确识别银行
3. 所有检测都通过才会判定为合法
4. 结果文件使用 UTF-8 编码，支持中文显示

## 不适用luhn的情况
1）部分招商银行（CMB）卡不使用 Luhn
尤其是：
招行运通卡（American Express）

一些旧卡段 BIN
这些卡号校验位不是 Luhn 算法，而是招行内部算法（未公开）。

2）中国银行（BOC）部分借记卡不使用 Luhn
尤其是：
老卡段（如 621660、621661 等部分号段）

BOC 有部分卡的规则不是 Luhn，而是内部校验（同样未公开）。

3）工行、农行、建行、邮储等老卡段也可能存在少量“不用 Luhn”的情况
银行卡体系在国家早期并未统一标准，因此历史遗留 BIN 都可能有差异。

### 解决办法
调整检测逻辑为：
1）长度要求检查（13-19）-> 若符合，则继续下一步；
2）BIN码检测及长度要求检测 -> 若符合下一步
3）判断改BIN码对应的卡是否适配luhn算法检测（需要事先对BIN表进行是否适配luhn算法进行标记）
-> 4‘）若不适用，返回真
4）若适用，继续luhn算法检测->若符合，返回真

notice:
4‘）可能存在误报：BIN码以及长度符合，但卡号是伪造
行业标准导致的，不是实现问题，实践场景中需要更多其他条件来辅助判断：

BIN + 长度 是必要条件，但不是充分条件，要想更准确，需要：
- 更精细的 BIN 库（8 位或 10 位）
- 卡号序列号规则
- 风控策略
- 银行内部校验 API
